{% extends 'base.html' %}
{% load static %}
{% load customTags %}

{% block title %}Budget Manager{% endblock %}

{% block extra_styles %}
<link rel="stylesheet" href="{% static 'css/budget/monthlyView.css' %}">
{% endblock %}

{% block content %}

<div class="container-fluid px-2">
  <table class="table table-dark table-bordered table-sm text-center align-middle">
    <thead>
      <tr>
        <td>
            <form method="get" id="filterForm" class="row g-2 mb-3">
                <div class="col-md-3">
                    <select name="year" id="yearSelect" class="form-select">
                    {% for y in finYears %}
                        <option value="{{ y.id }}" {% if y.id == selected_year_id %}selected{% endif %}>
                        {{ y.year }}
                        </option>
                    {% endfor %}
                    </select>
                </div>
                
                <div class="col-md-3">
                    <select name="month" id="monthSelect" class="form-select">
                    {% for m in months %}
                        <option value="{{ m.id }}" {% if m.id == month.id %}selected{% endif %}>
                        {{ m.monthDesc }}
                        </option>
                    {% endfor %}
                    </select>
                </div>
                
                <div class="col-md-1">
                    <button type="submit" class="btn btn-primary w-100">Filter</button>
                </div>
                <div class="col-md-1">
                    <a class="btn btn-warning" href="{% url 'budgetManager:budgetManager' %}">Back</a>
                </div>
            </form>

          <table class="table table-bordered table-dark table-sm mb-0">
            {% for earning in earnings %}
            <tr>
              <th class="w-25">{{ earning.desc }}</th>
            <th contenteditable="true"
                class="editable-cell"
                data-date="{% now 'Y-m-d' %}"
                data-item="{{ earning.id }}"
                data-month="{{ month.id }}"
                data-year="{{ finYear.id }}"
                data-path="{% url 'budgetManager:save_monthly_data' %}"
                data-valuetype="{{ earning.desc|valuetype_from_desc }}"
            >
                {{ totalEarning|dict_get:earning.id|default:0 }}
            </th>
            </tr>
            {% endfor %}
            <tr>
              <th>Total</th>
              <th>{{ overall_earnings}}</th>
            </tr>
          </table>
        </td>
        <td>
          <table class="table table-bordered table-dark table-sm mb-0">
            <tr><th class="w-25">Expected Total</th><th contenteditable="true" class="w-50">{{ overall_expected_total }}</th></tr>
            <tr><th>Expected Balance</th><th contenteditable="true">{{ expectedBalance }} </th></tr>
            <tr><th>Actual Total</th><th contenteditable="true">{{ overall_actual_total }}</th></tr>
            <tr><th>Actual Balance</th><th contenteditable="true">{{ actualBalance }}</th></tr>
          </table>
        </td>
      </tr>
    </thead>
  </table>

  <table class="table table-dark table-bordered table-sm text-center align-middle" id="sheetTable">
    <tbody>
      <tr>
        <td>Date</td>
        {% for expense in expenses %}
        <td>{{ expense.desc }}</td>
        {% endfor %}
      </tr>

      <tr class="table-warning text-dark fw-bold">
        <td>Expect Expense</td>
        {% for expense in expenses %}
        <td  contenteditable="true"
            class="editable-cell"
            data-date="{% now 'Y-m-d' %}"
            data-item="{{ expense.id }}"
            data-month="{{ month.id }}"
            data-year="{{ finYear.id }}"
            data-path="{% url 'budgetManager:save_monthly_data' %}"
            data-valuetype="ET"
        >{{ expectTotal|dict_get:expense.id|default:0 }}</td>
        {% endfor %}
      </tr>

      <tr class="table-danger text-white fw-bold">
        <td>Total Expense</td>
        {% for expense in expenses %}
        <td>{{ totals|dict_get:expense.id|default:0 }}</td>
        {% endfor %}
      </tr>

      <tr class="table-success text-white fw-bold">
        <td>Balance Amount</td>
        {% for expense in expenses %}
        <td>{{ balances|dict_get:expense.id|default:0 }}</td>
        {% endfor %}
      </tr>

      {% for date in dates %}
      <tr>
        <td>{{ date|date:"d/m/Y" }}</td>
        {% for expense in expenses %}
        <td  contenteditable="true"
            class="editable-cell"
            data-date="{{ date|date:'Y-m-d' }}"
            data-item="{{ expense.id }}"
            data-month="{{ month.id }}"
            data-year="{{ finYear.id }}"
            data-path="{% url 'budgetManager:save_monthly_data' %}"
            data-valuetype="MD"
        >{% get_value data_dict expense.id date 'MD' %}</td>
        {% endfor %}
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>




{% endblock %}

{% block extra_js %}
<script src="{% static 'js/budget/monthlyView.js' %}"></script>
{% endblock %}